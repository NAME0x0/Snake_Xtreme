<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake Xtreme - Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/retro-effects.css">
    <link rel="stylesheet" href="css/touch-controls.css">
    <link rel="stylesheet" href="css/game-debug.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.3.3/pixi.min.js"></script>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        <div class="crt-effect"></div>
        <div class="scanlines"></div>
        
        <div id="ui" class="game-ui">
            <div id="score">Score: 0</div>
            <div id="high-score">High Score: 0</div>
            <div id="achievements">Achievements: 0/3</div>
            <div id="coins">Coins: 0</div>
        </div>
        
        <!-- Add debug overlay -->
        <div id="debug-overlay" style="display:none"></div>
        <div class="game-state-indicator"></div>
        
        <div id="game-over-screen" style="display: none;" class="game-ui">
            <h1>Game Over</h1>
            <p class="big-score">Score: <span id="final-score">0</span></p>
            <p>High Score: <span id="high-score-display">0</span></p>
            
            <div class="game-over-buttons">
                <button id="restart-button">Restart</button>
                <button id="leaderboard-button">Leaderboard</button>
                <button id="menu-button">Main Menu</button>
            </div>
            
            <p class="restart-hint">Press SPACE to restart</p>
        </div>
        
        <div id="leaderboard" style="display: none;" class="game-ui">
            <h1>Leaderboard</h1>
            <ul id="leaderboard-list"></ul>
            <button id="back-to-game">Back</button>
        </div>
    </div>

    <script>
        // Add debug mode toggle
        const debugMode = true;
        
        if (debugMode) {
            // Make debug overlay visible
            document.addEventListener('DOMContentLoaded', function() {
                const overlay = document.getElementById('debug-overlay');
                if (overlay) {
                    overlay.style.display = 'block';
                    window.debugLog('Debug mode enabled');
                    window.debugLog('Watching for space bar press...');
                }
                
                // Add a direct start button on screen for testing
                const debugStartBtn = document.createElement('button');
                debugStartBtn.textContent = 'Force Start Game';
                debugStartBtn.style.position = 'fixed';
                debugStartBtn.style.bottom = '50px';
                debugStartBtn.style.right = '20px';
                debugStartBtn.style.zIndex = '9999';
                
                debugStartBtn.addEventListener('click', function() {
                    // Force game to start
                    window.debugLog('Force starting game...');
                    
                    // Remove start message if exists
                    const startMessage = document.getElementById('start-message');
                    if (startMessage && startMessage.parentNode) {
                        startMessage.parentNode.removeChild(startMessage);
                    }
                    
                    // Update global state
                    window.gameState = 'playing';
                    
                    // Update game's internal state if accessible
                    if (typeof gameState !== 'undefined') {
                        gameState = 'playing';
                        window.debugLog('Game state set to: playing');
                    }
                    
                    // Trigger a fake space key press
                    const spaceEvent = new KeyboardEvent('keydown', {
                        key: ' ',
                        code: 'Space',
                        which: 32,
                        keyCode: 32,
                        bubbles: true
                    });
                    document.dispatchEvent(spaceEvent);
                });
                
                document.body.appendChild(debugStartBtn);
                
                // Monitor all key presses
                document.addEventListener('keydown', function(e) {
                    window.debugLog(`Key pressed: ${e.key} (code: ${e.code})`);
                });
            });
            
            // Improved debug logger
            window.debugLog = function(message) {
                console.log(message);
                const overlay = document.getElementById('debug-overlay');
                if (overlay) {
                    const now = new Date();
                    const timestamp = now.getHours().toString().padStart(2, '0') + 
                                    ':' + now.getMinutes().toString().padStart(2, '0') + 
                                    ':' + now.getSeconds().toString().padStart(2, '0');
                    
                    const line = document.createElement('div');
                    line.textContent = `[${timestamp}] ${message}`;
                    overlay.appendChild(line);
                    
                    // Auto-scroll and limit entries
                    overlay.scrollTop = overlay.scrollHeight;
                    if (overlay.children.length > 15) {
                        overlay.removeChild(overlay.children[0]);
                    }
                }
            };
            
            // Better state indicator
            setInterval(() => {
                const indicator = document.querySelector('.game-state-indicator');
                if (indicator) {
                    const state = window.gameState || 'unknown';
                    const snakeInfo = window.snake ? 
                        `Snake: ${window.snake.segments ? window.snake.segments.length : 'N/A'} segments` : 'No snake';
                    indicator.innerHTML = `Game State: <b>${state}</b><br>${snakeInfo}`;
                }
            }, 500);
        } else {
            window.debugLog = function() {}; // No-op
        }
    </script>
    
    <!-- Add debug-game-state.js script -->

    <script src="js/render-utils.js"></script>
    <script src="js/input-handler.js"></script>
    <script src="js/game-enhancement.js"></script>
    <script src="js/touch-controls.js"></script>
    <script src="debug-game-state.js"></script>
    <script src="game.js"></script>
</body>
</html>